# =============================================================================
# Litecoin Knowledge Hub - Environment Variables Template
# =============================================================================
# Copy this file to create your environment-specific configuration:
#   - .env.local          (local development with localhost URLs)
#   - .env.docker.dev     (Docker development with service names)
#   - .env.docker.prod    (Docker production with production URLs)
#   - .env.prod-local     (local production build verification)
#
# See docs/setup/ENVIRONMENT_VARIABLES.md for full documentation.
# =============================================================================

# =============================================================================
# 1. SERVICE URLs
# =============================================================================
# Adjust these based on your environment (localhost vs Docker service names)

# Backend API URL (internal)
BACKEND_URL=http://localhost:8000

# Payload CMS public URL
PAYLOAD_PUBLIC_SERVER_URL=http://localhost:3001

# Frontend URL (for CORS/CSRF)
FRONTEND_URL=http://localhost:3000

# URLs exposed to browser (used by frontend and admin frontend)
NEXT_PUBLIC_BACKEND_URL=http://localhost:8000
NEXT_PUBLIC_PAYLOAD_URL=http://localhost:3001

# Admin frontend URL (automatically added to CORS origins)
ADMIN_FRONTEND_URL=http://localhost:3003

# =============================================================================
# 2. DATABASE CONNECTIONS
# =============================================================================
# For local MongoDB (Docker container):
#   MONGO_URI=mongodb://localhost:27017
# For cloud MongoDB (Atlas):
#   MONGO_URI=mongodb+srv://user:password@cluster.mongodb.net/litecoin_rag_db

MONGO_URI=mongodb://localhost:27017
MONGO_DETAILS=mongodb://localhost:27017
DATABASE_URI=mongodb://localhost:27017/payload_cms
REDIS_URL=redis://localhost:6379/0

# =============================================================================
# 3. SECRETS (set in service-specific .env files, not here)
# =============================================================================
# These are documented here but should be set in:
#   - backend/.env: GOOGLE_API_KEY, WEBHOOK_SECRET, ADMIN_TOKEN
#   - payload_cms/.env: PAYLOAD_SECRET, WEBHOOK_SECRET
#
# GOOGLE_API_KEY=your-google-api-key
# PAYLOAD_SECRET=your-payload-secret
# WEBHOOK_SECRET=your-webhook-secret
# ADMIN_TOKEN=your-admin-token

# =============================================================================
# 4. CONFIGURATION
# =============================================================================

# Database names
MONGO_DB_NAME=litecoin_rag_db
MONGO_COLLECTION_NAME=litecoin_docs

# Embedding model (default: local sentence-transformers)
EMBEDDING_MODEL=sentence-transformers/all-mpnet-base-v2

# CORS origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,https://chat.lite.space

# Rate limiting
RATE_LIMIT_PER_MINUTE=20
RATE_LIMIT_PER_HOUR=300

# Payload CMS URL for suggested questions
PAYLOAD_URL=http://localhost:3001
SUGGESTED_QUESTION_CACHE_TTL=86400

# Logging
LOG_LEVEL=INFO
JSON_LOGGING=false

# LLM spend limits
DAILY_SPEND_LIMIT_USD=5.00
HOURLY_SPEND_LIMIT_USD=1.00

# Challenge-response fingerprinting
CHALLENGE_TTL_SECONDS=300
CHALLENGE_RATE_LIMIT_PER_MINUTE=10
CHALLENGE_RATE_LIMIT_PER_HOUR=100
MAX_ACTIVE_CHALLENGES_PER_IDENTIFIER=3
ENABLE_CHALLENGE_RESPONSE=true

# Global rate limiting
GLOBAL_RATE_LIMIT_PER_MINUTE=1000
GLOBAL_RATE_LIMIT_PER_HOUR=50000
ENABLE_GLOBAL_RATE_LIMIT=true

# Cloudflare Turnstile (optional)
ENABLE_TURNSTILE=false
# TURNSTILE_SECRET_KEY=your-turnstile-secret

# Cost throttling
HIGH_COST_THRESHOLD_USD=10.0
HIGH_COST_WINDOW_SECONDS=600
ENABLE_COST_THROTTLING=true
COST_THROTTLE_DURATION_SECONDS=30

# Security
TRUST_X_FORWARDED_FOR=false

# =============================================================================
# 5. MONITORING (optional)
# =============================================================================

GRAFANA_ADMIN_USER=admin
# GRAFANA_ADMIN_PASSWORD must be set (no default)
GRAFANA_ADMIN_PASSWORD=

# =============================================================================
# 6. DOCKER-SPECIFIC
# =============================================================================

WATCHPACK_POLLING=true
HOSTNAME=0.0.0.0

# =============================================================================
# 7. LOCAL RAG - High-Performance Local Processing with Cloud Spillover
# =============================================================================
# Enable local-first RAG processing using Ollama (query rewriting), Infinity
# (embeddings), and Redis Stack (vector cache) with automatic cloud fallback.
#
# To enable, start Docker with the local-rag profile:
#   docker-compose -f docker-compose.prod.yml --profile local-rag up
#
# Then set these feature flags to true:
#   USE_LOCAL_REWRITER=true
#   USE_INFINITY_EMBEDDINGS=true
#   USE_REDIS_CACHE=true
#
# See docs/features/DEC6_FEATURE_HIGH_PERFORMANCE_LOCAL_RAG.md for details.
# =============================================================================

# --- Feature Flags ---
# Set to 'true' to enable local RAG processing (default: false, uses cloud)
USE_LOCAL_REWRITER=false
USE_INFINITY_EMBEDDINGS=false
USE_REDIS_CACHE=false

# --- Service URLs ---
# Docker internal URLs (use localhost:PORT when running scripts from host)
OLLAMA_URL=http://ollama:11434
INFINITY_URL=http://infinity:7997
REDIS_STACK_URL=redis://redis_stack:6379

# --- Router Configuration ---
# Maximum concurrent requests to local rewriter before spillover to Gemini
MAX_LOCAL_QUEUE_DEPTH=3
# Timeout for local rewriter before failing over to Gemini (seconds)
LOCAL_TIMEOUT_SECONDS=2.0

# --- Model Configuration ---
# Ollama model for query rewriting
LOCAL_REWRITER_MODEL=llama3.2:3b
# Infinity embedding model (1024-dim vectors)
EMBEDDING_MODEL_ID=dunzhang/stella_en_1.5B_v5
# Vector dimension (must match embedding model)
VECTOR_DIMENSION=1024

# --- Redis Stack Vector Cache ---
# Index name for vector cache
REDIS_CACHE_INDEX_NAME=cache:index
# Similarity threshold for cache hits (0.90 = 90% similarity required)
REDIS_CACHE_SIMILARITY_THRESHOLD=0.90
